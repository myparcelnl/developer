<template>
  <code>
    <AutoLink
      :item="linkItem"
      :class="classes">
      {{ text }}
    </AutoLink>
  </code>
</template>

<script lang="ts">
import { DataType, DataTypeWithId, useDataTypes } from '@mptheme/client/composables/useDataTypes';
import { computed, defineComponent, ref } from 'vue';
import AutoLink from '@mptheme/client/components/global/AutoLink.vue';
import { MyPaNavbarItem } from '@mptheme/config.types';
import { isOfType } from '@mptheme/shared/utils';

export default defineComponent({
  name: 'DataType',
  components: { AutoLink },
  props: {
    type: {
      type: String,
      required: true,
    },

    id: {
      type: [Number, String],
      default: null,
    },

    name: {
      type: String,
      default: null,
    },
  },

  setup: (props) => {
    const dataTypes = useDataTypes();
    const classes = ref<string[]>([]);

    const dataType = computed<DataType | null>(() => {
      return dataTypes.find((type) => type.name === props.type) ?? null;
    });

    const childType = computed<DataType['children'][number] | null>(() => {
      return dataType.value?.children.find((child) => {
        return isOfType<DataTypeWithId>(child, 'ID') ? child.ID === props.id : child.NAME === props.name;
      }) ?? null;
    });

    const text = computed<string>(() => {
      const child = childType.value;
      const id = isOfType<DataTypeWithId>(child, 'ID') ? child.ID : child?.NAME;
      const human = child?.HUMAN ? `(${child.HUMAN})` : '';

      return `${dataType.value?.name} ${id} ${human}`.trim();
    });

    const linkItem: MyPaNavbarItem = {
      link: `/api-reference/04.data-types.html#${dataType.value?.name}`,
      text: text.value,
    };

    return {
      text,
      classes,
      linkItem,
    };
  },
});
</script>
